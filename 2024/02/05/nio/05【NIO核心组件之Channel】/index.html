
<!DOCTYPE html><html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.26.8" theme-name="Stellar" theme-version="1.26.8">
  
  <meta name="generator" content="Hexo 7.1.1">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" content="#f8f8f8">
  
  <title>05 NIO核心组件之Channel - 笔记</title>

  
    <meta name="description" content="文章目录 五、NIO核心组件之Channel  5.1 FileChannel  5.1.1 FileChannel的基本使用 5.1.2 FileChannel的常用方法  1）truncate 2）size 3）position 4）force 5）transferFrom 6）transferTo   5.1.3 聚集和分散   5.2 DatagramChannel  5.2.1 Data">
<meta property="og:type" content="article">
<meta property="og:title" content="05 NIO核心组件之Channel">
<meta property="og:url" content="https://yi1108.github.io/2024/02/05/nio/05%E3%80%90NIO%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6%E4%B9%8BChannel%E3%80%91/index.html">
<meta property="og:site_name" content="笔记">
<meta property="og:description" content="文章目录 五、NIO核心组件之Channel  5.1 FileChannel  5.1.1 FileChannel的基本使用 5.1.2 FileChannel的常用方法  1）truncate 2）size 3）position 4）force 5）transferFrom 6）transferTo   5.1.3 聚集和分散   5.2 DatagramChannel  5.2.1 Data">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img-blog.csdnimg.cn/d273d59ba9a5402c81bb5bdafbb28d0b.png#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/cfd36769d45844d8b502bfd17e0d60a3.png#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/7e8a50750d994247ab3eeafaf802ee4f.png#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/133d498c8aa1469faf78e396fc427282.png#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/b12a0f0953a34da78cdfb5158291bed7.png#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/b1bb0ecd7efd40d595b4876248c99ec3.png#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/386627fa206c448bb017c6fb27303c71.png#pic_center">
<meta property="og:image" content="https://g.csdnimg.cn/extension-box/1.1.6/image/qq.png">
<meta property="og:image" content="https://g.csdnimg.cn/extension-box/1.1.6/image/ic_move.png">
<meta property="article:published_time" content="2024-02-05T09:00:07.000Z">
<meta property="article:modified_time" content="2024-02-28T07:26:18.506Z">
<meta property="article:author" content="yi">
<meta property="article:tag" content="nio">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/d273d59ba9a5402c81bb5bdafbb28d0b.png#pic_center">
  
  
  
  <meta name="keywords" content="nio">

  <!-- feed -->
  

  <link rel="stylesheet" href="/css/main.css?v=1.26.8">

  

  

  
  <link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont/style.css" media="print" onload="this.media='all'"><script>
  if (window.localStorage.getItem('ZYI_Theme_Mode')==='dark' || (window.localStorage.getItem('ZYI_Theme_Mode')==='Moss' && window.matchMedia('(prefers-color-scheme: dark)').matches)){
      document.querySelector("html").id = "ZYDark";
  }
</script>
<link rel="stylesheet" href="/customize/css/ZYDark.css">
</head>
<body>

<div class="l_body content tech" id="start" layout="post" ><aside class="l_left"><div class="sidebar-container">


<header class="header"><div class="logo-wrap"><a class="title" href="/"><div class="main" ff="title">笔记</div></a></div></header>

<div class="nav-area">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" placeholder="站内搜索"></form><div id="search-result"></div><div class="search-no-result">没有找到内容！</div></div>


<nav class="menu dis-select"><a class="nav-item active" title="博客" href="/" style="color:#1BCDFC"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M5.879 2.879C5 3.757 5 5.172 5 8v8c0 2.828 0 4.243.879 5.121C6.757 22 8.172 22 11 22h2c2.828 0 4.243 0 5.121-.879C19 20.243 19 18.828 19 16V8c0-2.828 0-4.243-.879-5.121C17.243 2 15.828 2 13 2h-2c-2.828 0-4.243 0-5.121.879M8.25 17a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75M9 12.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5zM8.25 9A.75.75 0 0 1 9 8.25h6a.75.75 0 0 1 0 1.5H9A.75.75 0 0 1 8.25 9" clip-rule="evenodd"/><path fill="currentColor" d="M5.235 4.058C5 4.941 5 6.177 5 8v8c0 1.823 0 3.058.235 3.942L5 19.924c-.975-.096-1.631-.313-2.121-.803C2 18.243 2 16.828 2 14v-4c0-2.829 0-4.243.879-5.121c.49-.49 1.146-.707 2.121-.803zm13.53 15.884C19 19.058 19 17.822 19 16V8c0-1.823 0-3.059-.235-3.942l.235.018c.975.096 1.631.313 2.121.803C22 5.757 22 7.17 22 9.999v4c0 2.83 0 4.243-.879 5.122c-.49.49-1.146.707-2.121.803z" opacity=".5"/></svg></a><a class="nav-item" title="文档" href="/wiki/" style="color:#3DC550"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M14.25 4.48v3.057c0 .111 0 .27.02.406a.936.936 0 0 0 .445.683a.96.96 0 0 0 .783.072c.13-.04.272-.108.378-.159L17 8.005l1.124.534c.106.05.248.119.378.16a.958.958 0 0 0 .783-.073a.936.936 0 0 0 .444-.683c.021-.136.021-.295.021-.406V3.031c.113-.005.224-.01.332-.013C21.154 2.98 22 3.86 22 4.933v11.21c0 1.112-.906 2.01-2.015 2.08c-.97.06-2.108.179-2.985.41c-1.082.286-1.99 1.068-3.373 1.436c-.626.167-1.324.257-1.627.323V5.174c.32-.079 1.382-.203 1.674-.371c.184-.107.377-.216.576-.323m5.478 8.338a.75.75 0 0 1-.546.91l-4 1a.75.75 0 0 1-.364-1.456l4-1a.75.75 0 0 1 .91.546" clip-rule="evenodd"/><path fill="currentColor" d="M18.25 3.151c-.62.073-1.23.18-1.75.336a8.2 8.2 0 0 0-.75.27v3.182l.75-.356l.008-.005a1.13 1.13 0 0 1 .492-.13c.047 0 .094.004.138.01c.175.029.315.1.354.12l.009.005l.749.356V3.647z"/><path fill="currentColor" d="M12 5.214c-.334-.064-1.057-.161-1.718-.339C8.938 4.515 8.05 3.765 7 3.487c-.887-.234-2.041-.352-3.018-.412C2.886 3.007 2 3.9 2 4.998v11.146c0 1.11.906 2.01 2.015 2.079c.97.06 2.108.179 2.985.41c.486.129 1.216.431 1.873.726c1.005.451 2.052.797 3.127 1.034z" opacity=".5"/><path fill="currentColor" d="M4.273 12.818a.75.75 0 0 1 .91-.545l4 1a.75.75 0 1 1-.365 1.455l-4-1a.75.75 0 0 1-.545-.91m.909-4.545a.75.75 0 1 0-.364 1.455l4 1a.75.75 0 0 0 .364-1.455z"/></svg></a></nav>
</div>
<div class="widgets">

<widget class="widget-wrapper toc single" id="data-toc" collapse="false"><div class="widget-header dis-select"><span class="name">本文目录</span></div><div class="widget-body fs14"><div class="doc-tree active"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95"><span class="toc-text">文章目录</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81NIO%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6%E4%B9%8BChannel"><span class="toc-text">五、NIO核心组件之Channel</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-FileChannel"><span class="toc-text">5.1 FileChannel</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-1-FileChannel%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-text">5.1.1 FileChannel的基本使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-2-FileChannel%E7%9A%84%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-text">5.1.2 FileChannel的常用方法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%EF%BC%89truncate"><span class="toc-text">1）truncate</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%EF%BC%89size"><span class="toc-text">2）size</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3%EF%BC%89position"><span class="toc-text">3）position</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4%EF%BC%89force"><span class="toc-text">4）force</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5%EF%BC%89transferFrom"><span class="toc-text">5）transferFrom</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6%EF%BC%89transferTo"><span class="toc-text">6）transferTo</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-3-%E8%81%9A%E9%9B%86%E5%92%8C%E5%88%86%E6%95%A3"><span class="toc-text">5.1.3 聚集和分散</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-DatagramChannel"><span class="toc-text">5.2 DatagramChannel</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-1-DatagramChannel%E7%AE%80%E4%BB%8B"><span class="toc-text">5.2.1 DatagramChannel简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-2-DatagramChannel%E7%9A%84%E8%8E%B7%E5%8F%96"><span class="toc-text">5.2.2 DatagramChannel的获取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-3-DatagramChannel%E7%9A%84%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-text">5.2.3 DatagramChannel的常用方法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%EF%BC%89%E5%8F%91%E9%80%81%E5%92%8C%E6%8E%A5%E6%94%B6"><span class="toc-text">1）发送和接收</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%EF%BC%89%E8%AF%BB%E5%8F%96%E5%92%8C%E5%86%99%E5%85%A5"><span class="toc-text">2）读取和写入</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-SocketChannel%E4%B8%8EServerSocketChannel"><span class="toc-text">5.3 SocketChannel与ServerSocketChannel</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-1-Channel%E7%9A%84%E7%AE%80%E4%BB%8B"><span class="toc-text">5.3.1 Channel的简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-2-Channel%E7%9A%84%E8%8E%B7%E5%8F%96"><span class="toc-text">5.3.2 Channel的获取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-3-Channel%E7%9A%84%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-text">5.3.3 Channel的常用方法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%EF%BC%89%E5%9F%BA%E6%9C%AC%E8%AF%BB%E5%86%99"><span class="toc-text">1）基本读写</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%EF%BC%89%E6%8B%B7%E8%B4%9D%E5%9B%BE%E7%89%87%E6%A1%88%E4%BE%8B"><span class="toc-text">2）拷贝图片案例</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3%EF%BC%89%E5%9C%A8%E7%BA%BF%E8%81%8A%E5%A4%A9%E6%A1%88%E4%BE%8B"><span class="toc-text">3）在线聊天案例</span></a></li></ol></li></ol></div></div></widget>







<widget class="widget-wrapper post-list"><div class="widget-header dis-select"><span class="name">最近更新</span></div><div class="widget-body fs14"><a class="item title" href="/2023/08/05/Spring-%E6%95%B4%E5%90%88-Redis-Stream-%E5%81%9A%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"><span class="title">Spring 整合 Redis Stream 做消息队列</span></a><a class="item title" href="/2022/11/12/docker%E5%AD%A6%E4%B9%A0/"><span class="title">docker学习</span></a><a class="item title" href="/2023/01/08/oauth/"><span class="title">oauth</span></a><a class="item title" href="/2022/11/08/git/"><span class="title">git</span></a><a class="item title" href="/2022/11/12/activiti%E5%AD%A6%E4%B9%A0/"><span class="title">activiti学习</span></a><a class="item title" href="/2022/11/30/py%E5%AD%A6%E4%B9%A0/"><span class="title">福瑞莱</span></a><a class="item title" href="/2022/11/01/SpringCloud%E5%AD%A6%E4%B9%A0/"><span class="title">SpringCloud学习</span></a><a class="item title" href="/2022/11/12/mysql%E8%A1%A8%E5%90%8D%E5%88%97%E5%90%8D%E8%BD%AC%E5%B0%8F%E5%86%99/"><span class="title">mysql表名列名转小写</span></a><a class="item title" href="/2022/07/09/redis%E5%AD%A6%E4%B9%A0%E5%B0%8F%E8%AE%B0/"><span class="title">redis学习小记</span></a><a class="item title" href="/2022/10/31/javase%E5%A4%8D%E4%B9%A0/"><span class="title">javase</span></a></div></widget>
</div>
<footer class="footer dis-select"><div class="social-wrap"><a class="social" href="javaScript:void('永夜');" rel="noopener noreferrer"><img class="lazy" id="ThemeM" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/customize/svg/moon.svg"/></a><a class="social" href="javaScript:void('永昼');" rel="noopener noreferrer"><img class="lazy" id="ThemeL" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/customize/svg/sun.svg"/></a></div></footer>
</div></aside><div class="l_main" id="main">





<div class="article banner top">
  <div class="content">
    
<div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">主页</a>
<span class="sep"></span><a class="cap breadcrumb" href="/">文章</a></div>
<div class="flex-row" id="post-meta"><span class="text created">发布于：<time datetime="2024-02-05T09:00:07.000Z">2024-02-05</time></span><span class="sep updated"></span><span class="text updated">更新于：<time datetime="2024-02-28T07:26:18.506Z">2024-02-28</time></span></div></div>
</div>

    
    <div class="bottom">
      <div class="text-area">
        <h1 class="text title"><span>05 NIO核心组件之Channel</span></h1>
      </div>
    </div>
    
  </div>
  </div><article class="md-text content"><h4 id="文章目录"><a href="#文章目录" class="headerlink" title="文章目录"></a>文章目录</h4><ul>
<li><a href="#NIOChannel_4">五、NIO核心组件之Channel</a></li>
<li><ul>
<li><a href="#51_FileChannel_17">5.1 FileChannel</a></li>
<li><ul>
<li><a href="#511_FileChannel_37">5.1.1 FileChannel的基本使用</a></li>
<li><a href="#512_FileChannel_251">5.1.2 FileChannel的常用方法</a></li>
<li><ul>
<li><a href="#1truncate_265">1）truncate</a></li>
<li><a href="#2size_304">2）size</a></li>
<li><a href="#3position_323">3）position</a></li>
<li><a href="#4force_408">4）force</a></li>
<li><a href="#5transferFrom_442">5）transferFrom</a></li>
<li><a href="#6transferTo_466">6）transferTo</a></li>
</ul>
</li>
<li><a href="#513__492">5.1.3 聚集和分散</a></li>
</ul>
</li>
<li><a href="#52_DatagramChannel_582">5.2 DatagramChannel</a></li>
<li><ul>
<li><a href="#521_DatagramChannel_584">5.2.1 DatagramChannel简介</a></li>
<li><a href="#522_DatagramChannel_598">5.2.2 DatagramChannel的获取</a></li>
<li><a href="#523_DatagramChannel_655">5.2.3 DatagramChannel的常用方法</a></li>
<li><ul>
<li><a href="#1_667">1）发送和接收</a></li>
<li><a href="#2_730">2）读取和写入</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#53_SocketChannelServerSocketChannel_930">5.3 SocketChannel与ServerSocketChannel</a></li>
<li><ul>
<li><a href="#531_Channel_932">5.3.1 Channel的简介</a></li>
<li><a href="#532_Channel_938">5.3.2 Channel的获取</a></li>
<li><a href="#533_Channel_1020">5.3.3 Channel的常用方法</a></li>
<li><ul>
<li><a href="#1_1039">1）基本读写</a></li>
<li><a href="#2_1121">2）拷贝图片案例</a></li>
<li><a href="#3_1125">3）在线聊天案例</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="五、NIO核心组件之Channel"><a href="#五、NIO核心组件之Channel" class="headerlink" title="五、NIO核心组件之Channel"></a>五、<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=NIO&spm=1001.2101.3001.7020">NIO</a>核心组件之Channel</h2><p>Java NIO的通道类似流，都是用于传输数据的。但通过又与流有些不同；<strong>流的数据走向是单向的</strong>，分为输入流（只能读取数据），输出流（只能写出数据），但NIO中的通道不一样，<strong>通道既可以写数据到Buffer，又可以从Buffer中读取数据；</strong></p>
<p><strong>另外流的操作对象是数组，而通道的操作对象是Buffer；</strong></p>
<ul>
<li>Java中常见的Channel如下：<ul>
<li><code>FileChannel</code>：用于文件 I&#x2F;O 编程</li>
<li><code>SocketChannel</code>、<code>ServerSocketChannel</code>：用于 TCP I&#x2F;O 编程</li>
<li><code>DatagramChannel</code>：用于 UDP I&#x2F;O 编程</li>
</ul>
</li>
</ul>
<h3 id="5-1-FileChannel"><a href="#5-1-FileChannel" class="headerlink" title="5.1 FileChannel"></a>5.1 FileChannel</h3><p>FileChannel是用于文件I&#x2F;O编程的管道类；通过FileInputStream和FileOutputStream可以获取一个关联文件的Channel，即FileChannel；</p>
<ul>
<li><code>public FileChannel getChannel()</code>：获取该流的Channel；</li>
</ul>
<p>示例代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过输入流获取Channel,该Channel只能读取数据</span></span><br><span class="line"><span class="type">FileChannel</span> <span class="variable">inChannel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;&quot;</span>).getChannel();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过输出流获取Channel,该Channel只能写出数据</span></span><br><span class="line"><span class="type">FileChannel</span> <span class="variable">outChannel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;&quot;</span>).getChannel();</span><br></pre></td></tr></table></figure>

<p><strong>我们可以读取Channel中的数据，也可以往Channel中写数据，Channel是可读可写的；但FileChannel最终需要将数据写入到对应的输入&#x2F;输出流，因为流是有顺序的，输入流只能读取数据，而输出流只能写出数据，因此使用FileInputStream&#x2F;FileOutputStream获取到的FileChannel只能读或写；</strong></p>
<h4 id="5-1-1-FileChannel的基本使用"><a href="#5-1-1-FileChannel的基本使用" class="headerlink" title="5.1.1 FileChannel的基本使用"></a>5.1.1 FileChannel的基本使用</h4><ul>
<li><code>int read(ByteBuffer dst)</code>：从Channel中读取数据，写入到Buffer中，返回读取到的有效字节个数，读取到末尾返回-1</li>
<li><code>int write(ByteBuffer src)</code>：从Buffer中读取数据，写入到Channel中，返回写出的有效字节个数，如果没有数据写出返回0</li>
</ul>
<p>案例1：通过Channel输出数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.dfbz.channel.fileChannel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.FileChannel;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lscl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@intro</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo01_FileChannel</span>的基本使用 &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writer</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. 创建一个输出流</span></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;001.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 通过输出流获取Channel</span></span><br><span class="line">        <span class="type">FileChannel</span> <span class="variable">channel</span> <span class="operator">=</span> fos.getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 创建一个Buffer</span></span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">        buffer.put(<span class="string">&quot;hello&quot;</span>.getBytes());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. 切换读模式(limit=position=5;position=0)</span></span><br><span class="line">        buffer.flip();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5. 将Buffer的数据读出来,写入到Channel中</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> channel.write(buffer);            <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;写出的有效字节个数: &quot;</span> + len);           <span class="comment">// 5</span></span><br><span class="line">        len = channel.write(buffer);</span><br><span class="line">        System.out.println(<span class="string">&quot;写出的有效字节个数: &quot;</span> + len);           <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line">        channel.close();</span><br><span class="line">        fos.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>注意：channel.write()方法是将数据从Buffer中读取出来，然后写入到Channel中，这对Buffer本质上是一次读操作，我们对Buffer的任何读写操作都会造成Buffer中的position位移；</strong></p>
<p>再次测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writer_02</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 创建一个输出流</span></span><br><span class="line">    <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;001.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 通过输出流获取Channel</span></span><br><span class="line">    <span class="type">FileChannel</span> <span class="variable">channel</span> <span class="operator">=</span> fos.getChannel();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 创建一个Buffer</span></span><br><span class="line">    <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">    System.err.println(buffer);             <span class="comment">// position=0,limit=capacity=1024</span></span><br><span class="line">    buffer.put(<span class="string">&quot;hello&quot;</span>.getBytes());</span><br><span class="line">    System.err.println(buffer);             <span class="comment">// position=5,limit=capacity=1024</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 切换读模式(limit=position=5;position=0)</span></span><br><span class="line">    buffer.flip();</span><br><span class="line">    System.err.println(buffer);             <span class="comment">// position=0,limit=5,capacity=1024</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. 将Buffer的数据读出来(也会造成position的位移),写入到Channel中</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> channel.write(buffer);            <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;写出的有效字节个数: &quot;</span> + len);           <span class="comment">// 5</span></span><br><span class="line">    len = channel.write(buffer);</span><br><span class="line">    System.out.println(<span class="string">&quot;写出的有效字节个数: &quot;</span> + len);           <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line">    System.err.println(buffer);             <span class="comment">// position=5,limit=5,capacity=1024</span></span><br><span class="line"></span><br><span class="line">    channel.close();</span><br><span class="line">    fos.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行程序，查看控制台：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://img-blog.csdnimg.cn/d273d59ba9a5402c81bb5bdafbb28d0b.png#pic_center" alt="在这里插入图片描述"></p>
<p>案例2：通过Channel读取数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reader</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 创建一个输入流</span></span><br><span class="line">    <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;001.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 通过输入流获取Channel</span></span><br><span class="line">    <span class="type">FileChannel</span> <span class="variable">channel</span> <span class="operator">=</span> fis.getChannel();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 创建一个Buffer</span></span><br><span class="line">    <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 从Channel中读取数据,写入到Buffer中</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> channel.read(buffer);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;读取到的有效字节个数: &quot;</span> + len);           <span class="comment">// 5</span></span><br><span class="line">    len = channel.read(buffer);</span><br><span class="line">    System.out.println(<span class="string">&quot;读取到的有效字节个数: &quot;</span> + len);           <span class="comment">// -1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// limit=position,position=0</span></span><br><span class="line">    buffer.flip();</span><br><span class="line"></span><br><span class="line">    <span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">byte</span>[buffer.limit()];</span><br><span class="line">    buffer.get(data);           <span class="comment">// 从Buffer中读取数据</span></span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(data, <span class="number">0</span>, data.length));</span><br><span class="line"></span><br><span class="line">    channel.close();</span><br><span class="line">    fis.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意：和write方法一样，channel调用read方法是将数据从Channel读取出来，往Buffer中写入，这对Buffer来说本质上是一种写的操作，我们对Buffer的任何读写操作都会造成Buffer中的position位移；</strong></p>
<p>再次测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reader_01</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 创建一个输入流</span></span><br><span class="line">    <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;001.txt&quot;</span>);       <span class="comment">// 文件内容: hello</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 通过输入流获取Channel</span></span><br><span class="line">    <span class="type">FileChannel</span> <span class="variable">channel</span> <span class="operator">=</span> fis.getChannel();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 创建一个Buffer</span></span><br><span class="line">    <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">    System.err.println(buffer);                                 <span class="comment">// position=0,limit=capacity=1024</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 从Channel中读取数据,写入到Buffer中(会造成position的位移)</span></span><br><span class="line">    channel.read(buffer);</span><br><span class="line">    System.err.println(buffer);                                 <span class="comment">// position=5,limit=capacity=1024</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// limit=position=5,position=0,capacity=1024</span></span><br><span class="line">    buffer.flip();</span><br><span class="line">    System.err.println(buffer);                                 <span class="comment">// position=0,limit=5,capacity=1024</span></span><br><span class="line"></span><br><span class="line">    <span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">byte</span>[buffer.limit()];</span><br><span class="line">    <span class="comment">// 从Buffer中读取数据</span></span><br><span class="line">    buffer.get(data);</span><br><span class="line">    System.err.println(buffer);                                 <span class="comment">// position=5,limit=5,capacity=1024</span></span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(data, <span class="number">0</span>, data.length));</span><br><span class="line"></span><br><span class="line">    channel.close();</span><br><span class="line">    fis.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行程序，查看控制台：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://img-blog.csdnimg.cn/cfd36769d45844d8b502bfd17e0d60a3.png#pic_center" alt="在这里插入图片描述"></p>
<ul>
<li>案例3-使用FileChannel拷贝文件：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">copy</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;100.png&quot;</span>);</span><br><span class="line">    <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;200.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">FileChannel</span> <span class="variable">inChannel</span> <span class="operator">=</span> fis.getChannel();</span><br><span class="line">    <span class="type">FileChannel</span> <span class="variable">outChannel</span> <span class="operator">=</span> fos.getChannel();</span><br><span class="line"></span><br><span class="line">    <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取Channel中的数据,写入到Buffer中</span></span><br><span class="line">    <span class="keyword">while</span> (inChannel.read(buffer) != -<span class="number">1</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// limit=position,position=0</span></span><br><span class="line">        buffer.flip();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 从Buffer中读取数据,写入Channel中</span></span><br><span class="line">        outChannel.write(buffer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// limit=capacity,position=0</span></span><br><span class="line">        buffer.clear();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    inChannel.close();</span><br><span class="line">    outChannel.close();</span><br><span class="line"></span><br><span class="line">    fis.close();</span><br><span class="line">    fos.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-1-2-FileChannel的常用方法"><a href="#5-1-2-FileChannel的常用方法" class="headerlink" title="5.1.2 FileChannel的常用方法"></a>5.1.2 FileChannel的常用方法</h4><ul>
<li><code>FileChannel truncate(long s)</code>：将此通道的文件截取为给定大小</li>
<li><code>long size()</code>：返回此通道的文件的当前大小</li>
<li><code>long position()</code>：返回该Channel目前所在的文件位置；</li>
<li><code>FileChannel position(long p)</code>：设置该Channel目前所在的文件位置；</li>
<li><code>public void force(boolean metaData)</code>：将当前Channel中的数据强制写入到磁盘中</li>
<li><code>public long transferFrom(ReadableByteChannel src, long position, long count)</code>：从src的position位置开始读取，读取count个字节到当前Channel中</li>
<li><code>public long transferTo(long position, long count,WritableByteChannel target)</code>：从当前Channel的position位置开始读取，读取count个字节到target中</li>
<li><code>long write(ByteBuffer[] srcs)</code> 将ByteBuffer[]到中的数据全部写入（聚集）到 Channel</li>
<li><code>long read(ByteBuffer[] dsts)</code> 将Channel到中的数据读取出来，然后全部写入（分散）到ByteBuffer[]</li>
</ul>
<hr>
<h5 id="1）truncate"><a href="#1）truncate" class="headerlink" title="1）truncate"></a>1）truncate</h5><ul>
<li><code>FileChannel truncate(long s)</code>：将此通道的文件截取为给定大小；</li>
</ul>
<p>可以使用FileChannel.truncate()方法截取一个文件。截取文件时，文件将中指定长度后面的部分将被删除。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">truncate</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">FileInputStream</span> <span class="variable">stream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;001.txt&quot;</span>);                     <span class="comment">// 文件内容: hello</span></span><br><span class="line"><span class="comment">//        FileOutputStream stream = new FileOutputStream(&quot;001.txt&quot;);                        // 文件内容: hello</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建流(可读可写)</span></span><br><span class="line"><span class="comment">//        RandomAccessFile stream = new RandomAccessFile(&quot;001.txt&quot;, &quot;rw&quot;);       // 文件内容: hello</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取Channel</span></span><br><span class="line">    <span class="type">FileChannel</span> <span class="variable">channel</span> <span class="operator">=</span> stream.getChannel();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将Channel的文件截取为2</span></span><br><span class="line">    channel.truncate(<span class="number">2</span>);                            <span class="comment">// 使用FileInputStream出现: java.nio.channels.NonWritableChannelException</span></span><br><span class="line"></span><br><span class="line">    <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    channel.read(buffer);                           <span class="comment">// 使用FileOutputStream出现: java.nio.channels.NonReadableChannelException</span></span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(buffer.array(), <span class="number">0</span>, buffer.array().length));         <span class="comment">// he</span></span><br><span class="line"></span><br><span class="line">    stream.close();</span><br><span class="line">    channel.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Tips：FileInputStream只能读取数据，因此使用FileInputStream获取的FileChannel也只能读取数据；同理FileOutputStream只能写出数据，使用FileOutputStream获取FileChannel也只能写出数据；因此上述案例中使用<code>RandomAccessFile</code>，即可读又可写；</p>
</blockquote>
<h5 id="2）size"><a href="#2）size" class="headerlink" title="2）size"></a>2）size</h5><p>FileChannel实例的size()方法将返回该实例所关联文件的大小。</p>
<ul>
<li><code>long size()</code>：返回此通道的文件的当前大小</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">size</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;001.txt&quot;</span>);</span><br><span class="line">    <span class="type">FileChannel</span> <span class="variable">channel</span> <span class="operator">=</span> fis.getChannel();</span><br><span class="line"></span><br><span class="line">    System.out.println(channel.size());         <span class="comment">// 5</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3）position"><a href="#3）position" class="headerlink" title="3）position"></a>3）position</h5><ul>
<li><code>long position()</code>：返回该Channel目前所在的文件位置；</li>
</ul>
<p>有时可能需要在FileChannel的某个特定位置进行数据的读&#x2F;写操作。可以通过调用position()方法获取FileChannel的当前位置。也可以通过调用position(long pos)方法设置FileChannel的当前位置。</p>
<ul>
<li>测试position：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.dfbz.channel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.FileChannel;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lscl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@intro</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo02_</span>常用方法 &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">position</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;001.txt&quot;</span>);</span><br><span class="line">        <span class="type">FileChannel</span> <span class="variable">channel</span> <span class="operator">=</span> fis.getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取此Channel的读写位置(默认为0)</span></span><br><span class="line">        System.out.println(channel.position());         <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 从Channel中读取数据到buffer中,读取了5个有效字节</span></span><br><span class="line">        channel.read(buffer);</span><br><span class="line">        System.out.println(<span class="string">&quot;buffer中的内容: &quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(buffer.array(), <span class="number">0</span>, buffer.array().length));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;---------------------&quot;</span>);</span><br><span class="line">        <span class="comment">// limit=capacity,position=0</span></span><br><span class="line">        buffer.clear();</span><br><span class="line"></span><br><span class="line">        System.out.println(channel.position());         <span class="comment">// 5</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将channel的读取位置设置为2</span></span><br><span class="line">        channel.position(<span class="number">2</span>);</span><br><span class="line">        channel.read(buffer);</span><br><span class="line">        System.out.println(<span class="string">&quot;buffer中的内容: &quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(buffer.array(), <span class="number">0</span>, buffer.array().length));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Tips：如果将位置设置在文件结束符之后，然后试图从文件通道中读取数据，读方法将返回-1 —— 文件结束标志。</p>
</blockquote>
<p><strong>如果将位置设置在文件结束符之后，然后向通道中写数据，文件将撑大到当前位置并写入数据。这可能导致“文件空洞”，磁盘上物理文件中写入的数据间有空隙。</strong></p>
<ul>
<li>测试position-2：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">position2</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建流(可读可写)</span></span><br><span class="line">    <span class="type">RandomAccessFile</span> <span class="variable">raf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(<span class="string">&quot;001.txt&quot;</span>, <span class="string">&quot;rw&quot;</span>);       <span class="comment">// 文件内容: hello</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取Channel</span></span><br><span class="line">    <span class="type">FileChannel</span> <span class="variable">channel</span> <span class="operator">=</span> raf.getChannel();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将position设置为size+10(空隙)</span></span><br><span class="line">    channel.position(channel.size()+<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 往Channel写出数据</span></span><br><span class="line">    channel.write(ByteBuffer.wrap(<span class="string">&quot;abc&quot;</span>.getBytes()));</span><br><span class="line"></span><br><span class="line">    raf.close();</span><br><span class="line">    channel.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>001.txt文件内容如下：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://img-blog.csdnimg.cn/7e8a50750d994247ab3eeafaf802ee4f.png#pic_center" alt="在这里插入图片描述"></p>
<h5 id="4）force"><a href="#4）force" class="headerlink" title="4）force"></a>4）force</h5><ul>
<li><code>public void force(boolean metaData)</code>：将当前Channel中的数据强制写入到磁盘中</li>
</ul>
<p>FileChannel.force()方法将通道里尚未写入磁盘的数据强制写到磁盘上。出于性能方面的考虑，操作系统会将数据缓存在内存中，所以无法保证写入到FileChannel里的数据一定会即时写到磁盘上。要保证这一点，需要调用force()方法。</p>
<p>另外，force()方法有一个<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=boolean%E7%B1%BB%E5%9E%8B&spm=1001.2101.3001.7020">boolean类型</a>的参数，指明是否同时将文件元数据（权限信息等）写到磁盘上</p>
<ul>
<li>测试代码：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">force</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建流(可读可写)</span></span><br><span class="line">    <span class="type">RandomAccessFile</span> <span class="variable">raf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(<span class="string">&quot;001.txt&quot;</span>, <span class="string">&quot;rw&quot;</span>);       <span class="comment">// 文件内容: hello</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取Channel</span></span><br><span class="line">    <span class="type">FileChannel</span> <span class="variable">channel</span> <span class="operator">=</span> raf.getChannel();</span><br><span class="line"></span><br><span class="line">    channel.write(ByteBuffer.wrap(<span class="string">&quot;Hello Everyone!&quot;</span>.getBytes()));</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        将内存中的数据强制写入到磁盘中</span></span><br><span class="line"><span class="comment">            true: 将文件元信息(权限信息等)写入磁盘</span></span><br><span class="line"><span class="comment">            false: 不写入文件元信息到磁盘</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    channel.force(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    raf.close();</span><br><span class="line">    channel.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5）transferFrom"><a href="#5）transferFrom" class="headerlink" title="5）transferFrom"></a>5）transferFrom</h5><ul>
<li><code>public long transferFrom(ReadableByteChannel src, long position, long count)</code>：从src的position位置开始读取，读取count个字节到当前Channel中</li>
</ul>
<p>FileChannel的transferFrom()方法可以将数据从源通道传输到FileChannel中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transferFrom</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">RandomAccessFile</span> <span class="variable">fromFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(<span class="string">&quot;001.txt&quot;</span>, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line">    <span class="type">FileChannel</span> <span class="variable">fromChannel</span> <span class="operator">=</span> fromFile.getChannel();</span><br><span class="line"></span><br><span class="line">    <span class="type">RandomAccessFile</span> <span class="variable">toFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(<span class="string">&quot;002.txt&quot;</span>, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line">    <span class="type">FileChannel</span> <span class="variable">toChannel</span> <span class="operator">=</span> toFile.getChannel();</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">position</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> fromChannel.size();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从fromChannel的position位置开始读取,读取count个字节到toChannel中</span></span><br><span class="line">    toChannel.transferFrom(fromChannel, position, count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="6）transferTo"><a href="#6）transferTo" class="headerlink" title="6）transferTo"></a>6）transferTo</h5><ul>
<li><code>public long transferTo(long position, long count,WritableByteChannel target)</code>：从当前Channel的position位置开始读取，读取count个字节到target中</li>
</ul>
<p>transferTo()方法将数据从FileChannel传输到其他的channel中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transferTo</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">RandomAccessFile</span> <span class="variable">fromFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(<span class="string">&quot;001.txt&quot;</span>, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line">    <span class="type">FileChannel</span> <span class="variable">fromChannel</span> <span class="operator">=</span> fromFile.getChannel();</span><br><span class="line"></span><br><span class="line">    <span class="type">RandomAccessFile</span> <span class="variable">toFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(<span class="string">&quot;002.txt&quot;</span>, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line">    <span class="type">FileChannel</span> <span class="variable">toChannel</span> <span class="operator">=</span> toFile.getChannel();</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">position</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> fromChannel.size();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从fromChannel的position位置开始读取,读取count到toChannel中</span></span><br><span class="line">    fromChannel.transferTo(position, count, toChannel);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-1-3-聚集和分散"><a href="#5-1-3-聚集和分散" class="headerlink" title="5.1.3 聚集和分散"></a>5.1.3 聚集和分散</h4><ul>
<li><p>聚集（gather）：写入Channel是指在写操作时将多个buffer的数据写入同一个Channel，因此，Channel 将多个Buffer中的数据“聚集（gather）”后发送到Channel。</p>
</li>
<li><p>分散（scatter）：从Channel中读取是指在读操作时将读取的数据写入多个buffer中。因此，Channel将从Channel中读取的数据“分散（scatter）”到多个Buffer中。</p>
</li>
</ul>
<p>scatter &#x2F; gather经常用于需要将传输的数据分开处理的场合，例如传输一个由消息头和消息体组成的消息，你可能会将消息体和消息头分散到不同的buffer中，这样你可以方便的处理消息头和消息体。</p>
<ul>
<li><code>long write(ByteBuffer[] srcs)</code> 将ByteBuffer[]到中的数据全部写入（聚集）到 Channel</li>
<li><code>long read(ByteBuffer[] dsts)</code> 将Channel到中的数据读取出来，然后全部写入（分散）到ByteBuffer[]</li>
</ul>
<hr>
<ul>
<li>Gathering Writes（聚集）：是指数据从多个buffer写入到同一个channel。如下图描述：</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://img-blog.csdnimg.cn/133d498c8aa1469faf78e396fc427282.png#pic_center" alt="在这里插入图片描述"></p>
<ul>
<li>Scattering Reads（分散）：是指数据从一个channel读取到多个buffer中。如下图描述：</li>
</ul>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://img-blog.csdnimg.cn/b12a0f0953a34da78cdfb5158291bed7.png#pic_center" alt="在这里插入图片描述"></p>
<ul>
<li>测试代码：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.dfbz.channel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.RandomAccessFile;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.FileChannel;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lscl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@intro</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo03_</span>聚集和分散 &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 聚集</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">gather</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">RandomAccessFile</span> <span class="variable">raf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(<span class="string">&quot;004.txt&quot;</span>, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line">        <span class="type">FileChannel</span> <span class="variable">channel</span> <span class="operator">=</span> raf.getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">header</span> <span class="operator">=</span> ByteBuffer.wrap(<span class="string">&quot;&#123;&#x27;content-Type&#x27;:&#x27;application/json&#x27;&#125;&quot;</span>.getBytes());</span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">body</span> <span class="operator">=</span> ByteBuffer.wrap(<span class="string">&quot;&#123;&#x27;username&#x27;:&#x27;admin&#x27;,&#x27;password&#x27;:&#x27;123&#x27;&#125;&quot;</span>.getBytes());</span><br><span class="line"></span><br><span class="line">        ByteBuffer[] bufferArray = &#123;header, body&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将多个Buffer聚集到一起写入到channel中</span></span><br><span class="line">        channel.write(bufferArray);</span><br><span class="line"></span><br><span class="line">        channel.close();</span><br><span class="line">        raf.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 分散</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">RandomAccessFile</span> <span class="variable">raf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(<span class="string">&quot;004.txt&quot;</span>, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line">        <span class="type">FileChannel</span> <span class="variable">channel</span> <span class="operator">=</span> raf.getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">header</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="string">&quot;&#123;&#x27;content-Type&#x27;:&#x27;application/json&#x27;&#125;&quot;</span>.getBytes().length);</span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">body</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="string">&quot;&#123;&#x27;username&#x27;:&#x27;admin&#x27;,&#x27;password&#x27;:&#x27;123&#x27;&#125;&quot;</span>.getBytes().length);</span><br><span class="line"></span><br><span class="line">        ByteBuffer[] bufferArray = &#123;header, body&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将channel中的数据分散读取,然后逐个写入到每个Buffer中</span></span><br><span class="line">        channel.read(bufferArray);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (ByteBuffer buffer : bufferArray) &#123;</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(buffer.array(),<span class="number">0</span>,buffer.array().length));</span><br><span class="line">        &#125;</span><br><span class="line">        channel.close();</span><br><span class="line">        raf.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-DatagramChannel"><a href="#5-2-DatagramChannel" class="headerlink" title="5.2 DatagramChannel"></a>5.2 DatagramChannel</h3><h4 id="5-2-1-DatagramChannel简介"><a href="#5-2-1-DatagramChannel简介" class="headerlink" title="5.2.1 DatagramChannel简介"></a>5.2.1 DatagramChannel简介</h4><p>DatagramChannel是用于UDP编程的Channel；获取到了DatagramChannel之后，可以使用Channel直接发送Buffer数据；因为UDP是无连接的网络协议，因此使用DatagramChannel发送的Buffer数据在发送时都会被封装成UDP报文，并且存在UDP协议的特性；</p>
<ul>
<li><strong>发送和接收报文</strong>：</li>
</ul>
<p>在使用DatagramChannel发送数据时，必须通过<code>InetSocketAddress</code>类来指定接收端的地址和端口；而在接收数据时，接收端的Channel必须先通过<code>InetSocketAddress</code>类绑定一个地址和端口；</p>
<ul>
<li><strong>读取和写入数据</strong>：</li>
</ul>
<p>DatagramChannel不仅可以发送报文和接收报文，还可以读取DatagreamChannel中的数据，或往DatagreamChannel中写入数据；与发送和接收不同，在使用DatagramChannel发送或接收时，DatagramChannel充当一个接收器&#x2F;发送器的角色，<strong>自己本身并不存储那些数据</strong>；而是将数据接收到一个Buffer中，而在使用DatagramChannel读取&#x2F;写入数据时，数据可以从Buffer中读取到Channel中，也可以从Channel写出到Buffer；</p>
<h4 id="5-2-2-DatagramChannel的获取"><a href="#5-2-2-DatagramChannel的获取" class="headerlink" title="5.2.2 DatagramChannel的获取"></a>5.2.2 DatagramChannel的获取</h4><p>在Java NIO中，我们可以通过DatagreamChannel来直接打开一个Channel，也可以DatagreamSocket可以获取到一个属于该Socket的Channel，<strong>但该Socket必须是由Channel获取的Socket</strong>；这两种方式获取到的Channel是同一个；</p>
<ul>
<li><p>DatagreamChannel方法：</p>
<ul>
<li><code>public static DatagramChannel open()</code> ：打开一个基于UDP协议的Channel管道；</li>
<li><code>public DatagramSocket socket()</code>：通过Channel获取一个Socket；</li>
</ul>
</li>
<li><p>DatagreamSocket方法：</p>
<ul>
<li><code>public DatagramChannel getChannel()</code>：获取该Socket的Channel管道；</li>
</ul>
</li>
</ul>
<p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.dfbz.channel.datagramChannel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.DatagramChannel;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lscl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@intro</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo01_DatagramChannel</span>的获取 &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 通过DatagramChannel打开一个Channel</span></span><br><span class="line">        <span class="type">DatagramChannel</span> <span class="variable">channel</span> <span class="operator">=</span> DatagramChannel.open();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过channel也可以获取一个socket</span></span><br><span class="line">        <span class="type">DatagramSocket</span> <span class="variable">socket</span> <span class="operator">=</span> channel.socket();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过socket也可以获取Channel</span></span><br><span class="line">        <span class="type">DatagramChannel</span> <span class="variable">channel2</span> <span class="operator">=</span> socket.getChannel();</span><br><span class="line">        System.out.println(channel2.getClass());            <span class="comment">// class sun.nio.ch.DatagramChannelImpl</span></span><br><span class="line"></span><br><span class="line">        System.out.println(channel == channel2);            <span class="comment">// true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">DatagramSocket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramSocket</span>(<span class="number">9999</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 不能通过DatagramSocket来获取channel</span></span><br><span class="line">        <span class="type">DatagramChannel</span> <span class="variable">channel</span> <span class="operator">=</span> socket.getChannel();</span><br><span class="line"></span><br><span class="line">        System.out.println(channel);            <span class="comment">// null</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-2-3-DatagramChannel的常用方法"><a href="#5-2-3-DatagramChannel的常用方法" class="headerlink" title="5.2.3 DatagramChannel的常用方法"></a>5.2.3 DatagramChannel的常用方法</h4><ul>
<li><code>public DatagramChannel bind(SocketAddress local)</code>：绑定当前客户端的地址和端口，其他Channel向当前Channel发送数据时指定的地址。<strong>在接收UDP报文时，必须先绑定；</strong></li>
<li><code>public SocketAddress receive(ByteBuffer dst)</code>：接收UDP报文，将接收到的UDP报文赋值给dst；</li>
<li><code>public int send(ByteBuffer src, SocketAddress target)</code>：发送一个UDP报文；并指定报文要发送的地址和端口</li>
<li><code>public DatagramChannel connect(SocketAddress remote)</code>：用于连接其他的DatagramChannel ，DatagramChannel之间建立连接后可以相互读取&#x2F;写入数据；</li>
</ul>
<blockquote>
<p>Tips：由于UDP是无连接的，使用connect方法连接到特定地址并不会像TCP通道那样创建一个真正的连接。而是锁住DatagramChannel ，让其只能从特定地址收发数据。因此即使是连接的地址不存在，也不会报错；</p>
</blockquote>
<h5 id="1）发送和接收"><a href="#1）发送和接收" class="headerlink" title="1）发送和接收"></a>1）发送和接收</h5><p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.dfbz.channel.datagramChannel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.DatagramChannel;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lscl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@intro</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo02_</span>发送和接收 &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送端</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sender</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过DatagramChannel打开一个Channel</span></span><br><span class="line">        <span class="type">DatagramChannel</span> <span class="variable">channel</span> <span class="operator">=</span> DatagramChannel.open();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 往该Channel写入数据</span></span><br><span class="line">        channel.send(ByteBuffer.wrap(<span class="string">&quot;hello&quot;</span>.getBytes()), <span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">9999</span>));</span><br><span class="line"></span><br><span class="line">        channel.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 接收端</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receive</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过DatagramChannel打开一个Channel</span></span><br><span class="line">        <span class="type">DatagramChannel</span> <span class="variable">channel</span> <span class="operator">=</span> DatagramChannel.open();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 绑定地址(用于接收该地址发送过来的数据)</span></span><br><span class="line">        channel.bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">9999</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用Buffer接收报文</span></span><br><span class="line">        channel.receive(buffer);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(buffer.array(), <span class="number">0</span>, buffer.array().length));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2）读取和写入"><a href="#2）读取和写入" class="headerlink" title="2）读取和写入"></a>2）读取和写入</h5><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://img-blog.csdnimg.cn/b1bb0ecd7efd40d595b4876248c99ec3.png#pic_center" alt="在这里插入图片描述"></p>
<ul>
<li>读取端：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.dfbz.channel.datagramChannel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.DatagramChannel;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lscl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@intro</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo03_</span>读取端 &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取Channel</span></span><br><span class="line">        <span class="type">DatagramChannel</span> <span class="variable">channel</span> <span class="operator">=</span> DatagramChannel.open();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            绑定一个地址</span></span><br><span class="line"><span class="comment">                1) 用于接收该地址发送的UDP报文</span></span><br><span class="line"><span class="comment">                2) 用于其他DatagramChannel与当前Channel建立连接(逻辑连接),待会可以使用Channel从127.0.0.1的9999端口读取数据</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">9999</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            连接一个地址:</span></span><br><span class="line"><span class="comment">                1) 建立一个UDP逻辑连接,如果需要读取127.0.0.2主机的数据则必须建立逻辑连接</span></span><br><span class="line"><span class="comment">                2) 建立好逻辑连接后,可以使用channel向127.0.0.2主机写入数据</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.connect(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="string">&quot;127.0.0.2&quot;</span>, <span class="number">9999</span>));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;开始接收数据: &quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;----------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建Buffer,用读取Channel中的数据</span></span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">readBuffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);                  <span class="comment">// position=0,limit=1024,capacity=1024</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将数据从Channel中读取出来,写入到readBuffer中</span></span><br><span class="line">            channel.read(readBuffer);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 预备下次一次从Channel读出数据写入到Buffer中[position=0,limit=capacity]</span></span><br><span class="line">            readBuffer.clear();</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;接收到来自【&quot;</span> + channel.getRemoteAddress() + <span class="string">&quot;】的数据: &quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(readBuffer.array(), <span class="number">0</span>, readBuffer.array().length));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>写入端：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.dfbz.channel.datagramChannel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.DatagramChannel;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lscl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@intro</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo04_</span>写入端 &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取Channel</span></span><br><span class="line">        <span class="type">DatagramChannel</span> <span class="variable">channel</span> <span class="operator">=</span> DatagramChannel.open();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            绑定一个地址</span></span><br><span class="line"><span class="comment">                1) 用于接收该地址发送的UDP报文</span></span><br><span class="line"><span class="comment">                2) 用于其他DatagramChannel与当前Channel建立连接(逻辑连接),待会可以使用Channel从127.0.0.2的9999端口读取数据</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="string">&quot;127.0.0.2&quot;</span>, <span class="number">9999</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 连接一个地址: 与指定的地址建立逻辑连接,用于向这个地址发送数据,待会可以使用Channel向写入数据到127.0.0.1的9999端口</span></span><br><span class="line">        channel.connect(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">9999</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建Buffer</span></span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">writeBuffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);       <span class="comment">// position=0,limit=1024,capacity=1024</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取一个扫描器</span></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;请输入数据: &quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 接收控制台输入的数据</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> scanner.nextLine();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将控制台输入的数据添加到buffer中</span></span><br><span class="line">            writeBuffer.put(str.getBytes());                    <span class="comment">// buffer的position会进行位移</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// limit=position,position=0</span></span><br><span class="line">            writeBuffer.flip();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 从Buffer中读取数据出来,往Channel中写入数据          // buffer的position会进行位移</span></span><br><span class="line">            channel.write(writeBuffer);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// position=0,limit=capacity(预备下一次写入)</span></span><br><span class="line">            writeBuffer.clear();</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;使用Channel向【&quot;</span> + channel.getRemoteAddress() + <span class="string">&quot;】发送了数据: &quot;</span> + str);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用一个Channel进行读取和写入：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.dfbz.channel.datagramChannel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.DatagramChannel;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lscl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@intro</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo05_</span>读取和写入 &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 读取/写入数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readerAndWriter</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取Channel</span></span><br><span class="line">        <span class="type">DatagramChannel</span> <span class="variable">channel</span> <span class="operator">=</span> DatagramChannel.open();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            绑定一个端口(本机)</span></span><br><span class="line"><span class="comment">                1) 接收127.0.0.1主机9999端口发送的UDP报文</span></span><br><span class="line"><span class="comment">                2) 用于其他DatagramChannel与当前Channel建立连接(逻辑连接),待会可以使用Channel从127.0.0.1的9999端口读取数据</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">9999</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            连接一个地址:</span></span><br><span class="line"><span class="comment">                1) 建立一个UDP逻辑连接,如果需要读取127.0.0.2主机的数据则必须建立逻辑连接</span></span><br><span class="line"><span class="comment">                2) 建立好逻辑连接后,可以使用channel向127.0.0.2主机写入数据</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.connect(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">9999</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建Buffer,用于往Channel写入数据</span></span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">writeBuffer</span> <span class="operator">=</span> ByteBuffer.wrap(<span class="string">&quot;hello&quot;</span>.getBytes());       <span class="comment">// position=0,limit=5,capacity=5</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建Buffer,用读取Channel中的数据</span></span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">readBuffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);                  <span class="comment">// position=0,limit=1024,capacity=1024</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将数据从writeBuffer中读取出来,写入到Channel中</span></span><br><span class="line">            channel.write(writeBuffer);                                     <span class="comment">// writeBuffer:[position=5,limit=5,capacity=5]</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 切换写模式读模式,writeBuffer:[position=0,limit=5,capacity=5]</span></span><br><span class="line">            writeBuffer.flip();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将数据从Channel中读取出来,写入到readBuffer中</span></span><br><span class="line">            channel.read(readBuffer);                                       <span class="comment">// readBuffer:[position=5,limit=1024,capacity=1024]</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 切换写模式,readBuffer:[position=0,limit=1024,capacity=1024]</span></span><br><span class="line">            readBuffer.clear();</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;Channel的数据: &quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(readBuffer.array(), <span class="number">0</span>, readBuffer.array().length));</span><br><span class="line"></span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-SocketChannel与ServerSocketChannel"><a href="#5-3-SocketChannel与ServerSocketChannel" class="headerlink" title="5.3 SocketChannel与ServerSocketChannel"></a>5.3 SocketChannel与ServerSocketChannel</h3><h4 id="5-3-1-Channel的简介"><a href="#5-3-1-Channel的简介" class="headerlink" title="5.3.1 Channel的简介"></a>5.3.1 Channel的简介</h4><p>BIO中Socket编程的两个核心类分别为：Socket（代表客户端）和ServerSocket（代表服务器端），通过ServerSocket的accept可以接收一个客户端的Socket；</p>
<p>在NIO中，提供有SocketChannel和ServerSocketChannel，分别代表客户端和服务端；底层依旧采用TCP协议进行数据的网络传输，同时这些Channel还支持非阻塞方式运行，这一点与原生的Socket&#x2F;ServerSocket有很大的不同；例如ServerSocketChannel在接收一个客户端时，如果还未有客户端来连接服务端，那么accept会返回null，而不是将当前线程阻塞；</p>
<h4 id="5-3-2-Channel的获取"><a href="#5-3-2-Channel的获取" class="headerlink" title="5.3.2 Channel的获取"></a>5.3.2 Channel的获取</h4><p>通过ServerSocketChannel也可以来获取一个SocketChannel；也可以和DatagramChannel一样，通过open方法来打开一个管道；并且通过Socket可以获取SocketChannel，通过ServerSocket可以获取ServerSocketChannel；</p>
<hr>
<p>和DatagramChannel一样，虽然通过Socket可以获取Channel，但该Socket必须是由Channel获取的Socket；因为原生的Socket的getChannel()方法永远返回的是null；</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://img-blog.csdnimg.cn/386627fa206c448bb017c6fb27303c71.png#pic_center" alt="在这里插入图片描述"></p>
<ul>
<li>测试代码：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.dfbz.channel.socketChannel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.ServerSocketChannel;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SocketChannel;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lscl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@intro</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo01_Channel</span>的获取 &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 获取socketChannel</span></span><br><span class="line">        <span class="type">SocketChannel</span> <span class="variable">socketChannel</span> <span class="operator">=</span> SocketChannel.open();</span><br><span class="line">        <span class="comment">// 通过channel获取socket</span></span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> socketChannel.socket();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过socket也可以获取对应的Channel</span></span><br><span class="line">        System.out.println(socket.getChannel() == socketChannel);           <span class="comment">// true</span></span><br><span class="line">        System.out.println(socket.getClass());              <span class="comment">// class sun.nio.ch.SocketAdaptor(并不是一个原生的Socket对象)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// serverSocketChannel</span></span><br><span class="line">        <span class="type">ServerSocketChannel</span> <span class="variable">serverSocketChannel</span> <span class="operator">=</span> ServerSocketChannel.open();</span><br><span class="line">        <span class="comment">// 通过channel获取socket</span></span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">serverSocket</span> <span class="operator">=</span> serverSocketChannel.socket();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过socket也可以获取对应的Channel</span></span><br><span class="line">        System.out.println(serverSocket.getChannel() == serverSocketChannel);           <span class="comment">// true</span></span><br><span class="line">        System.out.println(serverSocket.getClass());        <span class="comment">// class sun.nio.ch.ServerSocketAdaptor(并不是一个原生的ServerSocket对象)</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 原生的socket并不能获取Channel</span></span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>();</span><br><span class="line">        <span class="type">SocketChannel</span> <span class="variable">socketChannel</span> <span class="operator">=</span> socket.getChannel();</span><br><span class="line">        System.out.println(socketChannel);              <span class="comment">// null</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 原生的ServerSocket并不能获取Channel</span></span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">serverSocket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>();</span><br><span class="line">        <span class="type">ServerSocketChannel</span> <span class="variable">serverSocketChannel</span> <span class="operator">=</span> serverSocket.getChannel();</span><br><span class="line">        System.out.println(serverSocketChannel);        <span class="comment">// null</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// serverSocketChannel</span></span><br><span class="line">        <span class="type">ServerSocketChannel</span> <span class="variable">serverSocketChannel</span> <span class="operator">=</span> ServerSocketChannel.open();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 接收到一个socketChannel(客户端)</span></span><br><span class="line">        <span class="type">SocketChannel</span> <span class="variable">socketChannel</span> <span class="operator">=</span> serverSocketChannel.accept();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-3-3-Channel的常用方法"><a href="#5-3-3-Channel的常用方法" class="headerlink" title="5.3.3 Channel的常用方法"></a>5.3.3 Channel的常用方法</h4><ul>
<li>ServerSocketChannel：<ul>
<li><code>public static ServerSocketChannel open()</code>：获取一个ServerSocketChannel</li>
<li><code>public ServerSocket socket()</code>：通过当前Channel获取Socket</li>
<li><code>public ServerSocketChannel bind(SocketAddress local)</code>：绑定一个地址，用于客户端（SocketChannel）来连接</li>
<li><code>public SocketChannel accept()</code>：接收一个客户端（SocketChannel）；默认情况下，如果没有客户端来连接，那么accept会使得当前线程一直处于等待状态；</li>
<li><code>public SelectableChannel configureBlocking(boolean block)</code>：将当前Channel设置为非阻塞模式；默认为true（阻塞模式）</li>
<li><code>public boolean isBlocking()</code>：判断当前Channel是否为非阻塞模式；默认true（阻塞模式）</li>
</ul>
</li>
<li>SocketChannel：<ul>
<li><code>public static SocketChannel open()</code> ：获取一个SocketChannel</li>
<li><code>public Socket socket()</code>：通过当前Channel获取Socket；</li>
<li><code>public SocketChannel bind(SocketAddress local)</code>：绑定一个地址，默认是本机地址，SocketChannel的该方法没有意义，因为SocketChannel是一个客户端，用于连接ServerSocketChannel，通过ServerSocketChannel可以获取客户端的地址，默认情况下SocketChannel为本机地址，并随机分配一个端口；</li>
<li><code>public boolean connect(SocketAddress remote)</code>：用于连接服务端</li>
<li><code>public int read(ByteBuffer dst)</code>：读取Channel中的数据到Buffer中</li>
<li><code>public int write(ByteBuffer src)</code>：将Buffer中的数据写入到Channel中；</li>
<li><code>public SelectableChannel configureBlocking(boolean block)</code>：将当前Channel设置为非阻塞模式；默认为true（阻塞模式）</li>
<li><code>public boolean isBlocking()</code>：判断当前Channel是否为非阻塞模式；默认true（阻塞模式）</li>
</ul>
</li>
</ul>
<h5 id="1）基本读写"><a href="#1）基本读写" class="headerlink" title="1）基本读写"></a>1）基本读写</h5><ul>
<li>服务端：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.dfbz.channel.socketChannel和serverSocketChannel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.ServerSocketChannel;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SocketChannel;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lscl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@intro</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo02_</span>基本演示_服务端 &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">// 创建一个服务器</span></span><br><span class="line">        <span class="type">ServerSocketChannel</span> <span class="variable">serverSocketChannel</span> <span class="operator">=</span> ServerSocketChannel.open();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;等待客户端连接....&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 绑定一个地址</span></span><br><span class="line">        serverSocketChannel.bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">9999</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            接收一个客户端(如果没有客户端来连接则会造成阻塞)</span></span><br><span class="line"><span class="comment">            接收到了与客户端交互的Channel后,通过SocketChannel既可以向客户端写出数据,又可以读取来自客户端发送的数据</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">SocketChannel</span> <span class="variable">socketChannel</span> <span class="operator">=</span> serverSocketChannel.accept();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;客户端【&quot;</span> + socketChannel.getRemoteAddress() + <span class="string">&quot;】连接成功成功....&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 准备一个Buffer</span></span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.wrap(<span class="string">&quot;hello&quot;</span>.getBytes());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 往客户端写入数据</span></span><br><span class="line">        socketChannel.write(buffer);</span><br><span class="line"></span><br><span class="line">        socketChannel.close();</span><br><span class="line">        serverSocketChannel.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>客户端：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.dfbz.channel.socketChannel和serverSocketChannel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SocketChannel;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lscl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@intro</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo03_</span>基本演示_客户端 &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">server</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">SocketChannel</span> <span class="variable">socketChannel</span> <span class="operator">=</span> SocketChannel.open();</span><br><span class="line">        <span class="comment">// 连接到一个地址(如果该地址不存在,则默认情况下会阻塞,等到一定时间后抛出异常)</span></span><br><span class="line">        socketChannel.connect(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">9999</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 准备一个Buffer用于接收服务端的数据</span></span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 读取服务端的数据,返回数据的长度</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> socketChannel.read(buffer);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;数据长度: &quot;</span> + len);</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(buffer.array(), <span class="number">0</span>, buffer.array().length));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2）拷贝图片案例"><a href="#2）拷贝图片案例" class="headerlink" title="2）拷贝图片案例"></a>2）拷贝图片案例</h5><h5 id="3）在线聊天案例"><a href="#3）在线聊天案例" class="headerlink" title="3）在线聊天案例"></a>3）在线聊天案例</h5><p>仅限学习、交流使用！</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://g.csdnimg.cn/extension-box/1.1.6/image/qq.png"> QQ群名片</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://g.csdnimg.cn/extension-box/1.1.6/image/ic_move.png"></p>
<p>本文转自 <a target="_blank" rel="noopener" href="https://blog.csdn.net/Bb15070047748/article/details/125438312">https://blog.csdn.net/Bb15070047748/article/details/125438312</a>，如有侵权，请联系删除。</p>

<div class="article-footer fs14">
    <section id="license">
      <div class="header"><span>许可协议</span></div>
      <div class="body"><p>本文采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">署名-非商业性使用-相同方式共享 4.0 国际</a> 许可协议，转载请注明出处。</p>
</div>
    </section>
    </div>
</article>
<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">较新文章</div><a href="/2024/02/05/nio/02%E3%80%90Java%E7%9A%84IO%E6%A8%A1%E5%9E%8B%E3%80%91/">Java的IO模型</a></div><div class="item" id="next"><div class="note">较早文章</div><a href="/2024/02/05/nio/%E4%BA%94%E7%A7%8DIO%E6%A8%A1%E5%9E%8B%EF%BC%9A%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%BA%94%E7%A7%8DIO%E6%A8%A1%E5%9E%8B%E5%A4%A7%E5%85%A8/">五种IO模型：操作系统五种IO模型大全</a></div></section></div>






<footer class="page-footer footnote"><hr><div class="text"><p>本站由 <a href="/">yi</a> 使用 <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.26.8">Stellar 1.26.8</a> 主题创建。<br>本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处。</p>
</div></footer>
<div class='float-panel mobile-only blur' style='display:none'>
  <button type='button' class='sidebar-toggle mobile' onclick='sidebar.toggle()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
<div class="main-mask" onclick="sidebar.toggle()"></div></div></div><div class="scripts">
<script type="text/javascript">
  const stellar = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    loadCSS: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    // 从 butterfly 和 volantis 获得灵感
    loadScript: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = stellar.config.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    // https://github.com/jerryc127/hexo-theme-butterfly
    jQuery: (fn) => {
      if (typeof jQuery === 'undefined') {
        stellar.loadScript(stellar.plugins.jQuery).then(fn)
      } else {
        fn()
      }
    }
  };
  stellar.version = '1.26.8';
  stellar.github = 'https://github.com/xaoxuu/hexo-theme-stellar/tree/1.26.8';
  stellar.config = {
    date_suffix: {
      just: '刚刚',
      min: '分钟前',
      hour: '小时前',
      day: '天前',
      month: '个月前',
    },
    root : '/',
  };

  // required plugins (only load if needs)
  stellar.plugins = {
    jQuery: 'https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js'
  };

  if ('local_search') {
    stellar.search = {};
    stellar.search.service = 'local_search';
    if (stellar.search.service == 'local_search') {
      let service_obj = Object.assign({}, {"field":"all","path":"/search.json","content":true,"codeblock":true,"sort":"-date"});
      stellar.search[stellar.search.service] = service_obj;
    }
  }

  // stellar js
  stellar.plugins.stellar = Object.assign({"sites":"/js/plugins/sites.js","friends":"/js/plugins/friends.js","ghinfo":"/js/plugins/ghinfo.js","timeline":"/js/plugins/timeline.js","linkcard":"/js/plugins/linkcard.js","fcircle":"/js/plugins/fcircle.js","weibo":"/js/plugins/weibo.js","memos":"/js/plugins/memos.js","marked":"/js/plugins/marked.js"});

  stellar.plugins.marked = Object.assign("https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js");
  // optional plugins
  if ('true' == 'true') {
    stellar.plugins.lazyload = Object.assign({"enable":true,"js":"https://cdn.bootcdn.net/ajax/libs/vanilla-lazyload/17.8.4/lazyload.min.js","transition":"fade"});
  }
  if ('true' == 'true') {
    stellar.plugins.swiper = Object.assign({"enable":true,"css":"https://unpkg.com/swiper@10.3/swiper-bundle.min.css","js":"https://unpkg.com/swiper@10.3/swiper-bundle.min.js"});
  }
  if ('' == 'true') {
    stellar.plugins.scrollreveal = Object.assign({"enable":null,"js":"https://cdn.bootcdn.net/ajax/libs/scrollReveal.js/4.0.9/scrollreveal.min.js","distance":"16px","duration":800,"interval":100,"scale":1});
  }
  if ('true' == 'true') {
    stellar.plugins.preload = Object.assign({"enable":true,"service":"flying_pages","flying_pages":"https://cdn.bootcdn.net/ajax/libs/flying-pages/2.1.2/flying-pages.min.js"});
  }
  if ('true' == 'true') {
    stellar.plugins.fancybox = Object.assign({"enable":true,"js":"https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.umd.min.js","css":"https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.min.css","selector":null});
  }
  if ('false' == 'true') {
    stellar.plugins.heti = Object.assign({"enable":false,"css":"https://unpkg.com/heti@0.9.2/umd/heti.min.css","js":"https://unpkg.com/heti@0.9.2/umd/heti-addon.min.js"});
  }
  if ('true' == 'true') {
    stellar.plugins.copycode = Object.assign({"enable":true,"js":"/js/plugins/copycode.js","default_text":"Copy","success_text":"Copied","toast":"复制成功"});
  }
</script>

<!-- required -->
<script src="/js/main.js?v=1.26.8" async></script>

<!-- optional -->






<!-- inject -->
<script type="text/javascript" src="/customize/js/ZYDark.js"></script>
</div></body></html>
